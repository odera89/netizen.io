// Generated by CoffeeScript 1.3.1
((function(){var a,b={}.hasOwnProperty,c=function(a,c){function e(){this.constructor=a}for(var d in c)b.call(c,d)&&(a[d]=c[d]);return e.prototype=c.prototype,a.prototype=new e,a.__super__=c.prototype,a},d=[].indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1};a=function(a){var b,c,d,e,f,g;c={},g=a.attributes;for(e=0,f=g.length;e<f;e++){b=g[e];if(b.specified&&b.name.indexOf("data-")===0){d=b.value;try{d=jQuery.parseJSON(d)}catch(h){}d===null&&(d=""),c[b.name.substr(5)]=d}}return c},jQuery.extend(FrontEndEditor,{fieldTypes:{},edit_lock:function(a){return FrontEndEditor._editing=!0,a.trigger("edit_start")},edit_unlock:function(a){return FrontEndEditor._editing=!1,a.trigger("edit_stop")},is_editing:function(){return FrontEndEditor._editing},overlay:function(){var a;return a=jQuery("<div>",{"class":"fee-loading"}).css("background-image","url("+FrontEndEditor.data.spinner+")").hide().prependTo(jQuery("body")),{cover:function(b){var c,d,e,f,g;g=b.parents();for(e=0,f=g.length;e<f;e++){d=g[e],c=jQuery(d).css("background-color");if(c!=="transparent")break}return a.css({width:b.width(),height:b.height(),"background-color":c}).css(b.offset()).show()},hide:function(){return a.hide()}}}(),get_group_button:function(a){var b;return b=a.find(".fee-edit-button"),b.length?b:FrontEndEditor.data.add_buttons?(b=jQuery("<span>",{"class":"fee-edit-button",text:FrontEndEditor.data.edit_text}),b.appendTo(a),b):!1},init_fields:function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n;l=jQuery(".fee-group").not(".fee-initialized");for(h=0,j=l.length;h<j;h++){f=l[h],b=jQuery(f),c=b.find(".fee-field").removeClass("fee-field");if(!c.length)continue;e=function(){var a,b,e;e=[];for(a=0,b=c.length;a<b;a++)f=c[a],d=FrontEndEditor.make_editable(f),d.part_of_group=!0,e.push(d);return e}(),g=b.hasClass("status-auto-draft")?"createPost":"group",d=new FrontEndEditor.fieldTypes[g](b,e),a=FrontEndEditor.get_group_button(b),a?(a.click(jQuery.proxy(d,"start_editing")),b.bind({edit_start:function(b){return a.addClass("fee-disabled"),b.stopPropagation()},edit_stop:function(b){return a.removeClass("fee-disabled"),b.stopPropagation()}})):FrontEndEditor.hover_init(b,jQuery.proxy(d,"start_editing")),b.data("fee-editor",d)}m=jQuery(".fee-field").not(".fee-initialized"),n=[];for(i=0,k=m.length;i<k;i++)f=m[i],n.push(FrontEndEditor.make_editable(f,!0));return n},make_editable:function(b,c){var d,e,f,g;d=jQuery(b),e=a(b),d.addClass("fee-initialized"),g=FrontEndEditor.fieldTypes[e.type];if(!g){console&&console.warn("invalid field type",b);return}return f=new g,f.el=d,f.data=e,c&&(FrontEndEditor.hover_init(d,jQuery.proxy(f,"start_editing")),d.data("fee-editor",f)),f}}),FrontEndEditor.hover_init=function(){var a,b,c,d,e,f,g,h,i,j;return d=function(a){return{width:a.width(),height:a.height()}},a=2,b=2,e={lock:!1,timeout:null},f=jQuery("<div>").addClass("fee-hover-border").css("width",a).hide().appendTo("body"),g=jQuery("<div>",{"class":"fee-hover-edit",html:FrontEndEditor.data.edit_text,mouseover:function(){return e.lock=!0},mouseout:function(){return e.lock=!1,h()}}).hide().appendTo("body"),c=function(b){var c;return c=b-g.outerHeight()/2,g.css("top",c-a+"px")},i=function(){return g.hide(),f.hide()},h=function(){return e.timeout=setTimeout(function(){if(e.lock)return;return i()},300)},j=function(c){var h,j,k;return h=jQuery(this),k=h.offset(),j=d(h),j.width>h.parent().width()&&(h.css("display","block"),j=d(h)),clearTimeout(e.timeout),g.unbind("click"),g.bind("click",i),g.bind("click",c),g.css("left",k.left-g.outerWidth()-b+"px"),g.show(),f.css({left:k.left-b-a+"px",top:k.top-b-a+"px",height:j.height+b*2+"px"}).show()},function(a,b){return a.bind({mouseover:function(a){if(FrontEndEditor.is_editing())return;return c(a.pageY),j.call(this,b)},mousemove:function(a){return c(a.pageY)},mouseout:h})}}(),jQuery(document).ready(function(){var a,b,c,d,e,f;f=jQuery('[data-filter="widget_title"], [data-filter="widget_text"]');for(d=0,e=f.length;d<e;d++)c=f[d],a=jQuery(c),b=a.closest(".widget_text"),b.length?(a.attr("data-widget_id",b.attr("id")),b.addClass("fee-group")):a.unwrap();return FrontEndEditor.init_fields()}),jQuery(window).load(function(){var a;return(a=jQuery(".fee-group.status-auto-draft").data("fee-editor"))!=null?a.start_editing():void 0}),FrontEndEditor.fieldTypes.base=function(){function a(){}return a.name="base",a.prototype.get_type=function(){return this.constructor.displayName},a.prototype.start_editing=null,a.prototype.ajax_get=function(){return FrontEndEditor.edit_lock(this.el),this._ajax_request({data:this.ajax_get_args.apply(this,arguments),success:jQuery.proxy(this,"ajax_get_handler")})},a.prototype.ajax_set=function(){return this._ajax_request({data:this.ajax_set_args.apply(this,arguments),success:jQuery.proxy(this,"ajax_set_handler")})},a.prototype._ajax_request=function(a){return a.url=FrontEndEditor.data.ajax_url,a.type="POST",a.dataType="json",jQuery.ajax(a)},a.prototype.ajax_get_handler=null,a.prototype.ajax_set_handler=null,a.prototype.ajax_get_args=function(){var a;return a=this.ajax_args(),a.callback="get",a},a.prototype.ajax_set_args=function(a){var b;return b=this.ajax_args(),b.callback="save",b.content=a,b},a.prototype.ajax_args=function(){return{action:"front-end-editor",nonce:FrontEndEditor.data.nonce,data:this.data}},a}(),FrontEndEditor.fieldTypes.input=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="input",b.prototype.input_tag='<input type="text">',b.prototype.start_editing=function(){return this.create_form(),this.create_buttons(),this.create_input(),this.ajax_get(),!1},b.prototype.create_buttons=function(){return this.save_button=jQuery("<button>",{"class":"fee-form-save",text:FrontEndEditor.data.save_text,click:jQuery.proxy(this,"submit_form")}),this.cancel_button=jQuery("<button>",{"class":"fee-form-cancel",text:FrontEndEditor.data.cancel_text,click:jQuery.proxy(this,"remove_form")}),this.form.append(this.save_button).append(this.cancel_button)},b.prototype.create_form=function(){return this.form=this.el.is("span")?jQuery("<span>"):jQuery("<div>"),this.form.addClass("fee-form").addClass("fee-type-"+this.get_type()),this.form.keypress(jQuery.proxy(this,"keypress"))},b.prototype.remove_form=function(){return this.form.remove(),this.el.show(),FrontEndEditor.edit_unlock(this.el),!1},b.prototype.submit_form=function(a){return this.ajax_set(),!1},b.prototype.keypress=function(a){var b,c;c={ENTER:13,ESCAPE:27},b=a.keyCode||a.which||a.charCode||0,b===c.ENTER&&"input"===this.get_type()&&this.save_button.click();if(b===c.ESCAPE)return this.cancel_button.click()},b.prototype.create_input=function(){return this.input=jQuery(this.input_tag).attr({id:"fee-"+(new Date).getTime(),"class":"fee-form-content"}),this.input.prependTo(this.form)},b.prototype.content_to_input=function(a){return this.input.val(a)},b.prototype.content_from_input=function(){return this.input.val()},b.prototype.content_to_front=function(a){return this.el.html(a)},b.prototype.ajax_get=function(){return FrontEndEditor.overlay.cover(this.el),b.__super__.ajax_get.apply(this,arguments)},b.prototype.ajax_set_args=function(a){return FrontEndEditor.overlay.cover(this.form),0===arguments.length&&(a=this.content_from_input()),b.__super__.ajax_set_args.call(this,a)},b.prototype.ajax_get_handler=function(a){var b;b=this.error_handler(a);if(!b)return;return this.el.hide(),b.after(this.form),this.content_to_input(a.content),this.input.focus()},b.prototype.ajax_set_handler=function(a){var b;b=this.error_handler(a);if(!b)return;return this.content_to_front(a.content),this.remove_form()},b.prototype.error_handler=function(a){var b,c;return c=this.el.closest("a"),b=c.length?c:this.el,FrontEndEditor.overlay.hide(),a.error?(jQuery('<div class="fee-error">').append(jQuery('<span class="fee-message">').html(a.error)).append(jQuery('<span class="fee-dismiss">x</span>').click(function(){return $error_box.remove()})).insertBefore(b),!1):b},b}(FrontEndEditor.fieldTypes.base),FrontEndEditor.fieldTypes.select=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="select",b.prototype.input_tag="<select>",b.prototype.content_to_input=function(a){var b,c,d,e,f,g;f=this.data.values,g=[];for(b=d=0,e=f.length;d<e;b=++d)c=f[b],g.push(this.input.append(jQuery("<option>",{value:c,html:b,selected:a===c})));return g},b.prototype.content_from_input=function(){return this.input.find(":selected").val()},b}(FrontEndEditor.fieldTypes.input),FrontEndEditor.fieldTypes.textarea=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="textarea",b.prototype.input_tag='<textarea rows="10">',b}(FrontEndEditor.fieldTypes.input),FrontEndEditor.fieldTypes.image_base=function(a){function d(){return d.__super__.constructor.apply(this,arguments)}var b;return c(d,a),d.name="image_base",d.prototype.button_text=(b=FrontEndEditor.data.image)!=null?b.change:void 0,d.prototype.start_editing=function(){var a=this;return tb_show(this.button_text,FrontEndEditor.data.image.url),jQuery("#TB_closeWindowButton img").attr("src",FrontEndEditor.data.image.tb_close),jQuery("#TB_iframeContent").load(function(b){var c,d;d=b.currentTarget.contentWindow,c=d.jQuery(d.document),a.thickbox_load(c);if(jQuery.noop!==a.media_item_manipulation)return c.find(".media-item").each(function(b,c){return a.media_item_manipulation(d.jQuery(c))}),c.ajaxComplete(function(b,d){var e;return e=jQuery(d.responseText).find(".media-item-info").attr("id"),a.media_item_manipulation(c.find("#"+e).closest(".media-item"))})})},d.prototype.thickbox_load=function(a){var b=this;return a.delegate(".media-item :submit","click",function(a){var c,d;return c=jQuery(a.currentTarget),d=c.closest("form").serializeArray(),d.push({name:c.attr("name"),value:c.attr("name")}),d.push({name:"action",value:"fee_image_insert"}),jQuery.post(FrontEndEditor.data.ajax_url,d,jQuery.proxy(b,"image_html_handler")),!1})},d.prototype.media_item_manipulation=function(a){return a.find("#go_button").remove(),a.find(":submit").val(this.button_text)},d}(FrontEndEditor.fieldTypes.base),FrontEndEditor.fieldTypes.image=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="image",b.prototype.start_editing=function(){var a=this;return b.__super__.start_editing.apply(this,arguments),jQuery('<a id="fee-img-revert" href="#">').text(FrontEndEditor.data.image.revert).click(function(b){return a.ajax_set(-1),!1}).insertAfter("#TB_ajaxWindowTitle")},b.prototype.media_item_manipulation=function(a){return a.find("tbody tr").not(".image-size, .submit").hide(),b.__super__.media_item_manipulation.apply(this,arguments)},b.prototype.image_html_handler=function(a){var b;return b=jQuery(a),b.is("a")&&(b=b.find("img")),this.ajax_set(b.attr("src"))},b.prototype.ajax_set_handler=function(a){var b;return b=a.content,"-1"===b?location.reload(!0):(this.el.find("img").attr("src",b),tb_remove())},b}(FrontEndEditor.fieldTypes.image_base),FrontEndEditor.fieldTypes.thumbnail=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="thumbnail",b.prototype.thickbox_load=function(a){var b=this;return a.find("#tab-type_url").remove(),a.delegate(".media-item :submit","click",function(a){var c,d;return c=jQuery(a.currentTarget).closest(".media-item"),d=c.attr("id").replace("media-item-",""),b.ajax_set(d),!1})},b.prototype.media_item_manipulation=function(a){return a.find("tbody tr").not(".submit").remove(),b.__super__.media_item_manipulation.apply(this,arguments)},b}(FrontEndEditor.fieldTypes.image),typeof Aloha!="undefined"&&Aloha!==null&&Aloha.require(["aloha/selection"],function(a){return FrontEndEditor.fieldTypes.image_rich=function(b){function e(){return e.__super__.constructor.apply(this,arguments)}var d;return c(e,b),e.name="image_rich",e.prototype.button_text=(d=FrontEndEditor.data.image)!=null?d.insert:void 0,e.prototype.start_editing=function(){return jQuery(".aloha-floatingmenu, #aloha-floatingmenu-shadow").hide(),e.__super__.start_editing.apply(this,arguments)},e.prototype.media_item_manipulation=jQuery.noop,e.prototype.image_html_handler=function(b){return GENTICS.Utils.Dom.insertIntoDOM(jQuery(b),a.getRangeObject(),Aloha.activeEditable.obj),tb_remove(),jQuery(".aloha-floatingmenu, #aloha-floatingmenu-shadow").show()},e}(FrontEndEditor.fieldTypes.image_base)}),FrontEndEditor.fieldTypes.rich=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="rich",b.prototype.content_from_input=function(){return Aloha.getEditableById(this.form.attr("id")).getContents()},b.prototype.create_input=jQuery.noop,b.prototype.create_form=function(){return this.form=Aloha.jQuery('<div class="fee-form fee-type-rich">')},b.prototype.remove_form=function(){return this.form.mahalo(),b.__super__.remove_form.apply(this,arguments)},b.prototype.start_editing=function(a){return b.__super__.start_editing.apply(this,arguments),FrontEndEditor.current_field=this},b.prototype.ajax_get_handler=function(a){var b;b=this.error_handler(a);if(!b)return;this.create_form(),this.form.html(a.content),this.el.hide(),this.form.insertAfter(b),this.form.aloha();if(!this.part_of_group)return this.form.focus(),this.form.dblclick()},b}(FrontEndEditor.fieldTypes.textarea),FrontEndEditor.fieldTypes.terminput=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="terminput",b.prototype.content_to_input=function(a){return b.__super__.content_to_input.apply(this,arguments),this.input.suggest(FrontEndEditor.data.ajax_url+"?action=ajax-tag-search&tax="+this.data.taxonomy,{multiple:!0,resultsClass:"fee-suggest-results",selectClass:"fee-suggest-over",matchClass:"fee-suggest-match"})},b}(FrontEndEditor.fieldTypes.input),FrontEndEditor.fieldTypes.termselect=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="termselect",b.prototype.content_to_input=function(a){var b;return b=jQuery(a),this.input.replaceWith(b),this.input=b},b}(FrontEndEditor.fieldTypes.select),FrontEndEditor.fieldTypes.widget=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="widget",b.prototype.create_input=jQuery.noop,b.prototype.content_to_input=function(a){return this.input=jQuery(a),this.form.prepend(a)},b.prototype.ajax_set_args=function(){var a,c,d,e,f,g,h;a=b.__super__.ajax_set_args.apply(this,arguments),g=this.form.find(":input").serializeArray();for(e=0,f=g.length;e<f;e++)h=g[e],c=h.name,d=h.value,a[c]=a[c]===void 0?d:jQuery.isArray(a[c])?a[c].concat(d):[a[c],d];return a},b}(FrontEndEditor.fieldTypes.textarea),FrontEndEditor.fieldTypes.group=function(a){function e(a,b){var c,d,e,f;this.el=a,this.editors=b,this.has_aloha=!1;if(typeof Aloha!="undefined"&&Aloha!==null){f=this.editors;for(d=0,e=f.length;d<e;d++){c=f[d];if("rich"===c.get_type()){this.has_aloha=!0;return}}}}return c(e,a),e.name="group",e.prototype.start_editing=function(a){return this.create_form(),this.has_aloha?FrontEndEditor.current_field=this:this.create_buttons(),this.ajax_get(),!1},e.prototype.create_form=function(){var a,b,c,d;d=this.editors;for(b=0,c=d.length;b<c;b++)a=d[b],a.create_form(),a.create_input();return e.__super__.create_form.apply(this,arguments),this.el.append(this.form)},e.prototype.remove_form=function(a){var b,c,d,f;f=this.editors;for(c=0,d=f.length;c<d;c++)b=f[c],b.remove_form();return e.__super__.remove_form.apply(this,arguments)},e.prototype.content_from_input=function(){var a,b,c,d,e;d=this.editors,e=[];for(b=0,c=d.length;b<c;b++)a=d[b],e.push(a.content_from_input());return e},e.prototype.keypress=jQuery.noop,e.prototype.ajax_set=function(){return e.__super__.ajax_set.apply(this,arguments),FrontEndEditor.overlay.cover(this.el)},e.prototype.ajax_args=function(){var a,c,f,g,h,i,j,k,l,m,n;a=e.__super__.ajax_args.apply(this,arguments),a.group=!0,g=function(){var a,b,c,d;c=this.editors,d=[];for(a=0,b=c.length;a<b;a++)h=c[a],d.push(h.data);return d}.call(this);if(g.length===1)a.data=g;else{c=jQuery.extend({},g[0]);for(i=m=1,n=g.length;1<=n?m<n:m>n;i=1<=n?++m:--m)for(k in c){if(!b.call(c,k))continue;l=c[k],l!==g[i][k]&&delete c[k]}a.data=function(){var a,e,h;h=[];for(a=0,e=g.length;a<e;a++){f=g[a],j={};for(k in f){if(!b.call(f,k))continue;d.call(c,k)<0&&(j[k]=f[k])}h.push(j)}return h}(),a.commonData=c}return a},e.prototype.ajax_get_handler=function(a){var b,c,d,e,f,g;f=this.editors;for(c=d=0,e=f.length;d<e;c=++d)b=f[c],b.ajax_get_handler(a[c]);return(g=this.editors[0].input)!=null?g.focus():void 0},e.prototype.ajax_set_handler=function(a){var b,c,d,e,f;f=this.editors;for(c=d=0,e=f.length;d<e;c=++d)b=f[c],b.ajax_set_handler(a[c]);return this.remove_form()},e}(FrontEndEditor.fieldTypes.input),FrontEndEditor.fieldTypes.createPost=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return c(b,a),b.name="createPost",b.prototype.ajax_set_args=function(){var a;return a=b.__super__.ajax_set_args.apply(this,arguments),a.createPost=!0,a},b.prototype.ajax_set_handler=function(a){return window.location=a.permalink},b}(FrontEndEditor.fieldTypes.group)})).call(this);